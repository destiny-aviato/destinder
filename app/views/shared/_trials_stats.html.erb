<% info = get_stats("too") %>
<% username = @user.nil? ? @player_stat.display_name : @user.display_name %>
<% character_races = {0 => "Titan", 1 => "Hunter", 2 => "Warlock"} %>
<br>
<% if info.nil? %> 
  <div class="container games">
    ERROR: n00b!  NO TRIALS STATS FOUND FOR THIS PLAYER
  </div>
<% else %>  
    <% info.each_with_index do |x, index| %>
        <br/>
        <div ><!--OPEN FIRST CHARACTER--> 
            <div class="row white z-depth-2">
                <div class="col s12 m3 center-align background-trials-1">
                    <div class="row" style="margin-top:-8.5%; margin-left:4%;">
                        <div class="hlighten-5 z-depth-1 hoverable center-align" style="max-height: 400px; max-width: 228px;">
                        <% bg = "background-image: url(#{x["Character Items"]["Emblem Background"]});" %>
                            <div class="post-header" style="<%= bg %>">
                                <div class="row" style="overflow: hidden; max-height: 65px; ">
                                    <div class="col s12 m3 left-align" style="padding: 0; height: 65px;"><%= image_tag x["Character Items"]["Emblem"]["Item Icon"], style:"max-width: calc(100% - 2.6em); min-width: 65px; position: relative; right: 3%; height: auto;" %></div>
                                    <div class="col s12 m6 center-align" style="height: 65px; color: white; margin-top: 8%"><%= username %></div>
                                    <div class="col s12 m3 center-align" style="height: 65px; color: white;">
                                        <span style="color: gold; position: relative; top: 15%; line-height: 0.5em; font-weight: 300; font-size: 1.6em; margin-left: -70%;">✦ <%= x["Character Stats"]["Light Level"] %> </span>
                                        <span style ="font-weight: 300; font-size: 0.9em; margin-left: -50%;"><%= @character_races[x["Character Type"]] %></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                <div class="row" style="margin-top: 20%;">
                    <div class="col s6 center-align" style="color: white; font-size: 22px;"><%= x["Character Stats"]["K/D Ratio"] %> <span style="color:#cc0000;">KD</span></div>
                    <div class="col s6 center-align" style="color: white; font-size: 22px;"><%= x["Character Stats"]["ELO"]["ELO"] %> <span style="color:#cc0000;">ELO</span></div>
                </div>

                <div class="row">
                            <div class="col s12 player-reputation-trials center-align" style="color: white; margin-top: 2%;">Player Reputation</div>
                            <div class="col s12 center-align"> 
                                <% if !@user.nil? %>     
                                    <% total = @user.votes_for + @user.votes_against %>      
                                    <% rep =  total != 0  ? ((@user.votes_for / total).round(1) * 100) : "0" %>
                                    <% if current_user.voted_for?(@user) %>
                                        <%= link_to users_upvote_path(:voter => @user), method: :post, class: "waves-effect waves-light btn disabled" do %>
                                            <i class="material-icons">thumb_up</i>
                                        <% end %>

                                        <%= link_to users_downvote_path(:voter => @user), method: :post, class: "waves-effect waves-light btn disabled" do %>
                                            <i class="material-icons ">thumb_down</i>
                                        <% end %>
                                    <% else %>
                                        <%= link_to users_upvote_path(:voter => @user), method: :post, class: "waves-effect waves-light btn" do %>
                                            <i class="material-icons">thumb_up</i>
                                        <% end %>

                                        <%= link_to users_downvote_path(:voter => @user), method: :post, class: "waves-effect waves-light btn" do %>
                                            <i class="material-icons">thumb_down</i>
                                        <% end %>
                                    <% end %>
                                <% end %>
                            </div><!--CLOSE COLUMN-->
                            <div class="col s12 center-align" style="color:#cc0000; font-size: 22px;"><%= x["Character Items"]["Subclass"]["Item Name"] %></div>
                        
                        </div><!--CLOSE ROW-->


                                
                </div>

                <div class="col s12 m9 center-align">
                    <div class="row">
                        <div class="col s12 m4 center-align">
                        
                            <table>
                                <tr>
                                    <td><div class="col s4 m4 weapon-container"><img class="gun-icons-trials tooltipped" data-position="right" data-delay="50" data-tooltip="<%= x["Character Items"]["Primary Weapon"]["Item Name"] %>" src=<%= x["Character Items"]["Primary Weapon"]["Item Icon"] %> alt=""></div></td>
                                    <td style="font-size: 12px;"><%= x["Character Items"]["Primary Weapon"]["Item Name"] %></td>
                                    <td><div class="col s4 m4 weapon-container"><img class="gun-icons-trials tooltipped" data-position="right" data-delay="50" data-tooltip="<%= x["Character Items"]["Helmet"]["Item Name"] %>" src=<%= x["Character Items"]["Helmet"]["Item Icon"] %> alt=""></div></td>
                                    <td style="font-size: 12px;"><%= x["Character Items"]["Helmet"]["Item Name"] %></td>
                                </tr>
                                <tr>
                                <td><div class="col s4 m4 weapon-container"><img class="gun-icons-trials tooltipped" data-position="right" data-delay="50" data-tooltip="<%= x["Character Items"]["Secondary Weapon"]["Item Name"] %>" src=<%= x["Character Items"]["Secondary Weapon"]["Item Icon"] %> alt=""></div></td>
                                    <td  style="font-size: 12px;"><%= x["Character Items"]["Secondary Weapon"]["Item Name"]%></td>
                                    <td><div class="col s4 m4 weapon-container"><img class="gun-icons-trials tooltipped" data-position="right" data-delay="50" data-tooltip="<%= x["Character Items"]["Gauntlets"]["Item Name"] %>" src=<%= x["Character Items"]["Gauntlets"]["Item Icon"] %> alt=""></div></td>
                                    <td style="font-size: 12px;"><%= x["Character Items"]["Leg Armor"]["Item Name"] %></td>
                                </tr>
                                <tr>
                                    <td><div class="col s4 m4 weapon-container"><img class="gun-icons-trials tooltipped" data-position="right" data-delay="50" data-tooltip="<%= x["Character Items"]["Heavy Weapon"]["Item Name"] %>" src=<%= x["Character Items"]["Heavy Weapon"]["Item Icon"] %> alt=""></div></td>
                                    <td style="font-size: 12px;"><%= x["Character Items"]["Heavy Weapon"]["Item Name"] %></td>
                                    <td><div class="col s4 m4 weapon-container"><img class="gun-icons-trials tooltipped" data-position="right" data-delay="50" data-tooltip="<%= x["Character Items"]["Chest Armor"]["Item Name"] %>" src=<%= x["Character Items"]["Chest Armor"]["Item Icon"] %> alt=""></div></td>
                                    <td style="font-size: 12px;"><%= x["Character Items"]["Chest Armor"]["Item Name"] %></td>
                                </tr>
                            </table>
                        </div>                                           

                        <div class="col s12 m4 offset-m1 center-align">
                            <table style="color:grey;"> 
                                <tr> 
                                    <th></th>
                                    <th  style="font-size: 12px; color:#cc0000;" class="center-align table-header-trials">Week<hr></th>
                                    <th  style="font-size: 12px; color:#cc0000;" class="center-align table-header-trials">Map<hr></th>
                                </tr>
                                <tr> 
                                    <th style="font-size: 12px;" class="center-align table-header-trials" style="color:#cc0000;">KD</th>
                                    <th style="font-size: 12px;" class="trials-table-stats center-align">?</th>
                                    <th style="font-size: 12px;" class="trials-table-stats center-align">?</th>
                                </tr>
                                <tr> 
                                    <th style="font-size: 12px;" class="center-align table-header-trials" style="color:#cc0000;">KA/D</th>
                                    <th style="font-size: 12px;" class="trials-table-stats center-align">?</th>
                                    <th style="font-size: 12px;" class="trials-table-stats center-align">?</th>
                                </tr>
                                <tr> 
                                    <th style="font-size: 12px;" class="center-align table-header-trials" style="color:#cc0000;">Wins</th>
                                    <th style="font-size: 12px;" class="trials-table-stats center-align">?</th>
                                    <th style="font-size: 12px;" class="trials-table-stats center-align">?</th>
                                </tr>
                                <tr> 
                                    <th style="font-size: 12px;"  class="center-align table-header-trials" style="color:#cc0000;">Losses</th>
                                    <th style="font-size: 12px;"  class="trials-table-stats center-align">?</th>
                                    <th style="font-size: 12px;"  class="trials-table-stats center-align">?</th>
                                </tr>
                            

                                </table>

                        </div>

                        <div class="col s12 m3 center-align">
                            <h5 style="color:grey; font-size: 13px;">Badges<hr></h5>
                            <ul>
                                <!-- TODO: Add error handling for players who don't have an account with us -->
                                <% if !@user.nil? %>   
                                    <% @user.badges.each do |badge| %>                
                                        <li>
                                            <div class="chip tooltipped" style='<%= badge.custom_fields[:color] %>'data-position="top" data-delay="50" data-tooltip="<%= badge.description %>">
                                            <%= badge.name %>
                                            <%= badge.custom_fields[:icon].html_safe %>
                                            </div>  
                                        </li>              
                                    <% end %>
                                <% else %>
                                    N/A
                                <% end %>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div><!--CLOSE FIRST CHARACTER--> 
    <% end %>

    <div class="row">
            <div class="col s1"></div>
            <div class="col s6">
                <ul class="collapsible" data-collapsible="accordion" style="max-width: 170%; width: 337px;">
                    <% info.each do |x| %>
                    <% case x["Character Items"]["Subclass"]["Item Name"] 
                        when "Nightstalker", "Voidwalker", "Defender" %>
                            <% subclass =  "height: 20px; position: relative; bottom: 20px; background-image: url(#{image_path "void.png"}); background-size: cover;background-position-y: -50px;" %>
                            <% text_color =  "color: #f5f5f5; font-size: 14px; text-shadow: none;" %>
                        <% when "Sunsinger", "Gunslinger", "Sunbreaker" %>
                            <% subclass =  "height: 20px; position: relative; bottom: 20px;background-image: url(#{image_path "solar.png"}); background-size: cover;background-position-y: -50px;" %>
                            <% text_color =  "color: #3a3a3a; font-size: 14px;" %>
                        <% when "Bladedancer", "Striker", "Stormcaller" %>
                            <% subclass =  "height: 20px; position: relative; bottom: 20px; background-image: url(#{image_path "arc.png"}); background-size: cover;background-position-y: -50px;" %>
                            <% text_color =  "color: #3a3a3a; font-size: 14px;" %>
                    <% end %>
                    <li>
                        <div class="collapsible-header" style="height: 104px;">
                            <% bg = "background-image: url(#{x['Character Items']['Emblem Background']});" %>
                            <div class="post-header" style='<%= "#{bg} height: 100%; margin: -5.1%; height: 83px;" %>'>                            
                                <div class="row" style="overflow: hidden; max-height: 65px; ">
                                    <div class="col s3 left-align" style="padding: 0; height: 65px;">
                                        <%= image_tag x["Character Items"]["Emblem"]["Item Icon"], style:"max-width: calc(100% - 2.6em); min-width: 65px; position: relative; right: 3%; height: auto;" %>
                                    </div>
                                    <div class="col s6 center-align" style="height: 65px; color: white;"><span style="font-size: 1.5em; text-overflow: ellipsis; color: #f5f5f5; position: relative; top: 25%; font-weight: 400;" ><%= username %></span></div>
                                    <div class="col s3 center-align" style="height: 65px; color: white;">
                                        <span style="color: gold; position: relative; top: 10%; line-height: 2.5em; font-weight: 300; font-size: 0.9em;">✦ <%= x["Character Stats"]["Light Level"] %> </span>
                                        <span style="font-weight: 300; font-size: 0.9em;"><%= character_races[x["Character Type"]] %></span>
                                    </div>
                                </div>
                                <div class="post-subheader" style="position: relative;height: 18px;bottom: 20px;">
                                    <div class="container">
                                        <div class="row">
                                            <div class="col s4 left-align" style="white-space: nowrap;">
                                                <% if x["Character Stats"]["ELO"]["ELO"].to_i >= 1700 %>
                                                    <% elo = "<span class='tooltip' data-tooltip-content='#diamond_elo_content' style='color:#7198B7;'> <b>#{x['Character Stats']['ELO']['ELO']}</b></span> " %>
                                                <% elsif x["Character Stats"]["ELO"]["ELO"].to_i < 1700 && x["Character Stats"]["ELO"]["ELO"].to_i >= 1500 %>
                                                    <% elo = "<span class='tooltip' data-tooltip-content='#platinum_elo_content' style='color:#58907E;'> <b>#{x['Character Stats']['ELO']['ELO']}</b></span> " %>
                                                <% elsif x["Character Stats"]["ELO"]["ELO"].to_i < 1500 && x["Character Stats"]["ELO"]["ELO"].to_i >= 1300 %>
                                                    <% elo = "<span class='tooltip' data-tooltip-content='#gold_elo_content' style='color:#CCAE50;'> <b>#{x['Character Stats']['ELO']['ELO']}</b></span> " %>
                                                <% elsif x["Character Stats"]["ELO"]["ELO"].to_i < 1300 && x["Character Stats"]["ELO"]["ELO"].to_i >= 1200 %>
                                                    <% elo = "<span class='tooltip' data-tooltip-content='#silver_elo_content'  style='color:#BFC4C2;'> <b>#{x['Character Stats']['ELO']['ELO']}</b></span> " %>
                                                <% elsif x["Character Stats"]["ELO"]["ELO"].to_i < 1200 %>
                                                    <% elo = "<span class='tooltip' data-tooltip-content='#bronze_elo_content' style='color:#AA885F;'> <b>#{x['Character Stats']['ELO']['ELO']}</b></span> " %>
                                                <% end %>                                                    
                                                <span class="white-text" style="font-size: 11px; vertical-align: text-top;">ELO: <%= elo.html_safe %></span>
                                            </div>
                                            <div class="col s4 center-align" style="white-space: nowrap;">
                                                <span class="white-text" style="font-size: 11px; vertical-align: text-top;">KD: <%= x["Character Stats"]["K/D Ratio"] %></span>
                                            </div>
                                            <div class="col s4 right-align" style="white-space: nowrap;">
                                                <span class="white-text" style="font-size: 11px; vertical-align: text-top;">W/L: <%= x["Character Stats"]["Win Rate"] %>%</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="post-subclass-header" style='<%= subclass %>' ></div>
                            </div>
                        </div>
    
                        <div class="collapsible-body"><span>Lorem ipsum dolor sit amet.</span></div>
                    </li>
                    <% end %>
                </ul>
            </div>
            <div class="col s5"></div>
        </div>
<% end %>

